# config

> This project was generated by [generator-tf-module](https://github.com/sudokar/generator-tf-module)

## Overview

Configures AWS Config

## Usage

```hcl

provider "config_aggregator" {
...
}


provider "config" {
...
}


 module "config_aggregator_account" {
  providers = {
    aws = aws.config_aggregator
  }
  source = "../."

  name = var.name

  config_s3_bucket_name = aws_s3_bucket.example.id
  config_s3_bucket_prefix = "configtest"
  config_recorder_all_supported = false

  is_aggregator = true
  config_aggregate_enable_all_regions = false
  config_aggregate_regions = [data.aws_region.current.name]
  config_aggregate_account_ids = [local.aggregated_account]
}

module "config" {
  providers = {
    aws = aws.config
  } 
  source = "../."

  name = var.name

  config_s3_bucket_name         = aws_s3_bucket.example.id
  config_s3_bucket_prefix       = "configtest"
  config_recorder_all_supported = false

  is_aggregator         = false
  aggregator_account_id = local.config_aggregator_account
}

#tfsec:ignore:AWS002 #tfsec:ignore:AWS017
resource "aws_s3_bucket" "example" {
  bucket = replace(lower(var.name), "/[^a-z0-9+]+/", "")
  acl    = "private"

  tags = {
    Environment = "test"
    Terratest   = "true"
  }
}

data "aws_region" "current" {}
```

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3, < 2.0 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 5.0, < 6.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | >= 5.0, < 6.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [aws_config_aggregate_authorization.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/config_aggregate_authorization) | resource |
| [aws_config_config_rule.rules](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/config_config_rule) | resource |
| [aws_config_configuration_aggregator.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/config_configuration_aggregator) | resource |
| [aws_config_configuration_recorder.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/config_configuration_recorder) | resource |
| [aws_config_configuration_recorder_status.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/config_configuration_recorder_status) | resource |
| [aws_config_delivery_channel.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/config_delivery_channel) | resource |
| [aws_iam_policy.config_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_policy) | resource |
| [aws_iam_role.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role_policy_attachment.config_policy_attach](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) | resource |
| [aws_iam_role_policy_attachment.service_role_policy_attach](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) | resource |
| [aws_caller_identity.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/caller_identity) | data source |
| [aws_iam_policy_document.config_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_kms_key.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/kms_key) | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_aggregate_account_ids"></a> [aggregate\_account\_ids](#input\_aggregate\_account\_ids) | Account IDs of AWS accounts to aggregate AWS Config outputs from. Provided accounts must be pre-configured with `aws_config_aggregate_authorization` specifying this account ID. | `list(string)` | `null` | no |
| <a name="input_aggregator_account_id"></a> [aggregator\_account\_id](#input\_aggregator\_account\_id) | Account ID to grant permissions to aggregate Config outputs from this account. | `string` | `null` | no |
| <a name="input_config_aggregate_account_ids"></a> [config\_aggregate\_account\_ids](#input\_config\_aggregate\_account\_ids) | List of 12-digit account IDs of the account(s) being aggregated. | `list(string)` | `[]` | no |
| <a name="input_config_aggregate_enable_all_regions"></a> [config\_aggregate\_enable\_all\_regions](#input\_config\_aggregate\_enable\_all\_regions) | If true, aggregate existing AWS Config regions and future regions. | `bool` | `true` | no |
| <a name="input_config_aggregate_regions"></a> [config\_aggregate\_regions](#input\_config\_aggregate\_regions) | List of source regions being aggregated. | `list(string)` | `[]` | no |
| <a name="input_config_delivery_frequency"></a> [config\_delivery\_frequency](#input\_config\_delivery\_frequency) | The frequency with which AWS Config recurringly delivers configuration snapshots. Valid inputs: ( One\_Hour \| Three\_Hours \| Six\_Hours \| Twelve\_Hours \| TwentyFour\_Hours ) | `string` | `null` | no |
| <a name="input_config_recorder_all_supported"></a> [config\_recorder\_all\_supported](#input\_config\_recorder\_all\_supported) | Specifies whether AWS Config records configuration changes for every supported type of regional resource (which includes any new type that will become supported in the future). Conflicts with resource\_types | `bool` | `true` | no |
| <a name="input_config_recorder_iam_role_arn"></a> [config\_recorder\_iam\_role\_arn](#input\_config\_recorder\_iam\_role\_arn) | ARN of an AWS role for use by AWS Config Recorder, used to enable the same role to be used across multi-region deploys. | `string` | `null` | no |
| <a name="input_config_recorder_include_global_resource_types"></a> [config\_recorder\_include\_global\_resource\_types](#input\_config\_recorder\_include\_global\_resource\_types) | Specifies whether AWS Config includes all supported types of global resources with the resources that it records. Requires all\_supported = true. Conflicts with resource\_types | `bool` | `null` | no |
| <a name="input_config_recorder_resource_types"></a> [config\_recorder\_resource\_types](#input\_config\_recorder\_resource\_types) | A list that specifies the types of AWS resources for which AWS Config records configuration changes (for example, AWS::EC2::Instance or AWS::CloudTrail::Trail). config\_recorder\_all\_supported must be set to false | `list(string)` | `null` | no |
| <a name="input_config_rules"></a> [config\_rules](#input\_config\_rules) | A map providing details on any AWS Config rules to create. See readme details for variable format examples. | `any` | `{}` | no |
| <a name="input_config_s3_bucket_name"></a> [config\_s3\_bucket\_name](#input\_config\_s3\_bucket\_name) | Name of the S3 bucket AWS Config will output to | `string` | n/a | yes |
| <a name="input_config_s3_bucket_prefix"></a> [config\_s3\_bucket\_prefix](#input\_config\_s3\_bucket\_prefix) | An optional prefix to prepend to the path Config writes to S3 under | `string` | `""` | no |
| <a name="input_config_sns_topic_arn"></a> [config\_sns\_topic\_arn](#input\_config\_sns\_topic\_arn) | The ARN of the SNS topic that AWS Config delivers notifications to. | `string` | `null` | no |
| <a name="input_create_delivery_channel"></a> [create\_delivery\_channel](#input\_create\_delivery\_channel) | Boolean to toggle creation of AWS Config delivery channel | `bool` | `true` | no |
| <a name="input_is_aggregator"></a> [is\_aggregator](#input\_is\_aggregator) | Boolean to toggle if this account is an AWS Config Aggregator. If true, aggregation\_account\_ids is required. | `bool` | `false` | no |
| <a name="input_is_recorder"></a> [is\_recorder](#input\_is\_recorder) | Boolean to toggle if this region/account has an AWS Config Recorder. | `bool` | `true` | no |
| <a name="input_kms_keys"></a> [kms\_keys](#input\_kms\_keys) | List of KMS key identifiers to grant the AWS config role access to. E.g. for S3 bucket or SNS topic encryption. | `set(string)` | `[]` | no |
| <a name="input_name"></a> [name](#input\_name) | A name to use as part of resource naming | `string` | n/a | yes |
| <a name="input_tags"></a> [tags](#input\_tags) | A map of tags to add to all resources | `map(string)` | `{}` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_this_aws_config_aggregate_authorization_arn"></a> [this\_aws\_config\_aggregate\_authorization\_arn](#output\_this\_aws\_config\_aggregate\_authorization\_arn) | The ARN of the config aggregator authorization (if created) |
| <a name="output_this_aws_config_configuration_aggregator_arn"></a> [this\_aws\_config\_configuration\_aggregator\_arn](#output\_this\_aws\_config\_configuration\_aggregator\_arn) | The ARN of the config aggregator (if created) |
| <a name="output_this_aws_config_configuration_recorder_id"></a> [this\_aws\_config\_configuration\_recorder\_id](#output\_this\_aws\_config\_configuration\_recorder\_id) | Name of the recorder |
| <a name="output_this_aws_config_delivery_channel_id"></a> [this\_aws\_config\_delivery\_channel\_id](#output\_this\_aws\_config\_delivery\_channel\_id) | The name of the delivery channel |
| <a name="output_this_aws_config_delivery_channel_s3_bucket_name"></a> [this\_aws\_config\_delivery\_channel\_s3\_bucket\_name](#output\_this\_aws\_config\_delivery\_channel\_s3\_bucket\_name) | The name of the s3 bucket the delivery channel records to |
| <a name="output_this_aws_config_delivery_channel_s3_key_prefix"></a> [this\_aws\_config\_delivery\_channel\_s3\_key\_prefix](#output\_this\_aws\_config\_delivery\_channel\_s3\_key\_prefix) | Optional prefix on delivery channel S3 output |
| <a name="output_this_aws_config_rules"></a> [this\_aws\_config\_rules](#output\_this\_aws\_config\_rules) | If created, list of maps of all attributes of created config rules |
| <a name="output_this_aws_iam_role_arn"></a> [this\_aws\_iam\_role\_arn](#output\_this\_aws\_iam\_role\_arn) | ARN of the IAM role used by AWS Config |
| <a name="output_this_aws_iam_role_id"></a> [this\_aws\_iam\_role\_id](#output\_this\_aws\_iam\_role\_id) | Name of the IAM role used by AWS Config |
| <a name="output_this_aws_iam_role_unique_id"></a> [this\_aws\_iam\_role\_unique\_id](#output\_this\_aws\_iam\_role\_unique\_id) | Unique ID of the IAM role used by AWS Config |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->

## Development

### Prerequisites

- [terraform](https://learn.hashicorp.com/terraform/getting-started/install#installing-terraform)
- [terraform-docs](https://github.com/segmentio/terraform-docs)
- [pre-commit](https://pre-commit.com/#install)
- [golang](https://golang.org/doc/install#install)
- [golint](https://github.com/golang/lint#installation)

### Configurations

- Configure pre-commit hooks
```sh
pre-commit install
```


- Configure golang deps for tests
```sh
> go get github.com/gruntwork-io/terratest/modules/terraform
> go get github.com/stretchr/testify/assert
```



### Tests

- Tests are available in `test` directory

- In the test directory, run the below command
```sh
go test
```



## Authors

This project is authored by below people

- Matt Stone

> This project was generated by [generator-tf-module](https://github.com/sudokar/generator-tf-module)
