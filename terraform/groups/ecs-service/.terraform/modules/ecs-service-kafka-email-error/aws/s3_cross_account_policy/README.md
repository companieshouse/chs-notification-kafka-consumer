# s3_cross_account_policy

> This project was generated by [generator-tf-module](https://github.com/sudokar/generator-tf-module)

## Overview

Module to create an S3 bucket policy to grant cross account access to specified principles, ensuring that the bucket owner account retains access to any created objects.

## Usage

```hcl
module "s3_bucket" {
  source = "terraform-aws-modules/s3-bucket/aws"

  bucket = var.name
  acl    = "private"

  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}

module "aws_s3_bucket_policy" {
  source = "../"

  bucket_name           = module.s3_bucket.this_s3_bucket_id
  attach_policy         = true
  bucket_read_accounts  = [data.aws_caller_identity.current.account_id]
  bucket_write_accounts = [data.aws_caller_identity.current.account_id]

  // Depends on to avoid issues with conflicting operations adding bucket policy and public bock resources
  depends_on = [ module.s3_bucket ]
}
```

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3, < 2.0 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 5.0, < 6.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | >= 5.0, < 6.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [aws_s3_bucket_ownership_controls.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_ownership_controls) | resource |
| [aws_s3_bucket_policy.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_policy) | resource |
| [aws_iam_policy_document.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_attach_policy"></a> [attach\_policy](#input\_attach\_policy) | True to attach the generated policy to the provided S3 Bucket, false to just output the bucket policy document to be used elsewhere. | `bool` | `true` | no |
| <a name="input_bucket_delete_accounts"></a> [bucket\_delete\_accounts](#input\_bucket\_delete\_accounts) | List of account IDs to delegate delete object access to in the bucket policy. | `list(string)` | `[]` | no |
| <a name="input_bucket_name"></a> [bucket\_name](#input\_bucket\_name) | Name of the S3 bucket. Used for generating policy document resources and optionally for attachment of the policy. | `string` | n/a | yes |
| <a name="input_bucket_read_accounts"></a> [bucket\_read\_accounts](#input\_bucket\_read\_accounts) | List of account IDs to delegate read access to in the bucket policy. | `list(string)` | `[]` | no |
| <a name="input_bucket_write_accounts"></a> [bucket\_write\_accounts](#input\_bucket\_write\_accounts) | List of account IDs to delegate write access to in the bucket policy. | `list(string)` | `[]` | no |
| <a name="input_bucket_write_accounts_no_acl"></a> [bucket\_write\_accounts\_no\_acl](#input\_bucket\_write\_accounts\_no\_acl) | List of account IDs to delegate write access to in the bucket policy without the bucket-owner-full-control ACL enforced. | `list(string)` | `[]` | no |
| <a name="input_custom_statements"></a> [custom\_statements](#input\_custom\_statements) | Allows custom statements to be added to the policy | `any` | `null` | no |
| <a name="input_s3_bucket_allow_ssl_only"></a> [s3\_bucket\_allow\_ssl\_only](#input\_s3\_bucket\_allow\_ssl\_only) | Adds policy block that will block any non-SSL requests to the S3 bucket. | `bool` | `true` | no |
| <a name="input_s3_bucket_ownership_control"></a> [s3\_bucket\_ownership\_control](#input\_s3\_bucket\_ownership\_control) | S3 bucket ownership controls to apply to the bucket. Valid values: BucketOwnerPreferred, ObjectWriter or BucketOwnerEnforced. Default value: BucketOwnerPreferred | `string` | `"BucketOwnerPreferred"` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_s3_bucket_policy_document"></a> [s3\_bucket\_policy\_document](#output\_s3\_bucket\_policy\_document) | The IAM policy document created by this module |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->

## Development

### Prerequisites

- [terraform](https://learn.hashicorp.com/terraform/getting-started/install#installing-terraform)
- [terraform-docs](https://github.com/segmentio/terraform-docs)
- [pre-commit](https://pre-commit.com/#install)
- [golang](https://golang.org/doc/install#install)
- [golint](https://github.com/golang/lint#installation)

### Configurations

- Configure pre-commit hooks
```sh
pre-commit install
```


- Configure golang deps for tests
```sh
> go get github.com/gruntwork-io/terratest/modules/terraform
> go get github.com/stretchr/testify/assert
```



### Tests

- Tests are available in `test` directory

- In the test directory, run the below command
```sh
go test
```



## Authors

This project is authored by below people

- Matt Stone

> This project was generated by [generator-tf-module](https://github.com/sudokar/generator-tf-module)
